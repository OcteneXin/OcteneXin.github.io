---
layout: post
---

------

![img](https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/e/e3/A_new_village_in_the_plains_biome.png/revision/latest/scale-to-width-down/1000?cb=20181007011116)

> 平原村庄。可以看到村庄道路、房屋、花卉、路灯等特性。



我们小时候都玩过拼图。一片小小的厚纸片，被你的手指放在桌面上旋转着，移动着，寻找一个合适的配对物。你的拼图能拼得很大，几百、几千块拼图的规模也不算少见。

现在Notch手头上也有一些拼图，但是他的玩法大不相同。

他的每一块拼图都画着独特的景物，比如一座房子或一条路。每一块拼图都有一些**凹陷**和**凸起**，就像我们平常见到的那样。

他有许多取之不尽的拼图池子，每次需要拼图的时候就从指定的池子里随手捞上一块——由于权重的原因，有些拼图似乎更容易被捞到。池子里的拼图不管怎么捞都不会减少。

他的拼图可以在平面上拼在一起（稍后我会解释什么叫“拼在一起”），就像我们在桌面上玩的时候那样；但他的拼图也可以在竖直方向拼合，想想现在流行的3D拼图吧。

当他面对一个平面上的拼图时，他能够旋转自己的拼图，朝东，朝南，朝西，或朝北。

当他面对一个竖直方向拼合的拼图时，他可以选择旋转自己的拼图——只能绕y轴旋转。这意味着他不会把一个原本向下的拼图翻成向上的，尽管他本来可以这样做。

当他面对一个竖直方向拼合的拼图时，他也可以选择不旋转自己的拼图——怎么从池子里拿出来就怎么拼上去。

他的拼图可以被二次塑形，因为他的桌面（即当前的地形）不平。他往往需要把拼图按一按才能使它贴合在当前的地形上。

他也可以选择不对拼图进行塑形，这时他会强行把这块拼图摆放在它的位置上，将桌子也一同破坏。

他的拼图上的景物可以随着桌面的情况而变化：如果桌面上有一小片水，那么原本画着草径的拼图就会变成画着木板的样子。

他的每块拼图的每个凹陷都有特定的形状。他知道这块拼图表示的结构是什么，就据此来设计上面的凹陷——有**几块**拼图表示的结构是一个小房子，他就把这**几块**拼图上的**每个**凹陷都雕刻成小房子。

他的每块拼图的每个凸起都有特定的形状，这表示它能匹配的凹陷是什么——仍然用上面的例子，一个小房子形状的凸起会匹配小房子形状的凹陷，进而匹配那个凹陷所在的拼图，我们拼图也是这样拼的。

他的每块拼图的每个凸起都有特定的提示，提示去哪个池子里去找它的匹配物。Notch的池子随着版本迭代越来越多，光是村庄相关的就有十几个；他不得不在拼图的凸起上写下这样的提示。

他给自己的拼图游戏设定了可变的难度。他限制自己只用7层（以后会解释什么叫“层”）拼图或更少来完成自己的创作，这有时充满挑战性：但他仍然有办法解除这个限制。

他试图让自己的作品变得完美——那些凸起和凹陷毕竟不太美观，他会设法在拼图完成后清除它们，让它们转变为与拼图中“景物”相协调的方块。

他有时需要对自己的拼图过程加以调试，这时他不会抹去每块拼图的凸起和凹陷，就便于观察了。

Notch就这样乐此不疲地玩着自己的拼图游戏。许多巨大的结构由此产生，包括充满活力的村庄，危机四伏的掠夺者哨塔，岩浆环绕的猪灵堡垒，和埋没于地底的远古城市。



###Jeb的新发明：从拼图方块说起

> *"Notch，你觉得世界生成还有什么不足之处？"*
>
> *“唉，林地府邸、主世界要塞这些东西竟然还是setBlock，我写得都想打人。”*
>
> *"不是有结构方块吗？"*
>
> *“不过你觉得48方块的立方体能做些什么呢？”*
>
> *——也许是 Notch 和 Jeb 的一段对话*



Notch近来非常苦恼。随着mc以越来越快的频率进行更新，世界上的结构也越来越多。之前的结构都是硬编码的，就是单纯的几千行setBLock。

当他发现了结构方块的妙用之后，利用它提供的旋转、平移功能，可以快速调用模板进行结构的生成。但是正如他所说的，结构方块的规模对于一般的建筑而言太小了，又要在代码里硬编码结构方块的位置了——这对调试而言无异于恶梦。

“我讨厌硬编码的东西。”

这时，Jeb神神秘秘地拿出了一个紫黑色的方块。



> 这不又是结构方块吗——等等，它好像长得和结构方块不一样？
>
> 看一下注册名：minecraft: jigsaw
>
> 一条白线，几个箭头，一个拼图状的图案。
>
> F3看一下方块状态：south_up。



Notch把这个方块从地上拿起来，感受着这个方块奇妙的，金属般的触感。

![img](https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/9/94/Jigsaw_Block_%28S%29_JE3_BE2.png/revision/latest/scale-to-width-down/300?cb=20200417014529)

> “拼图方块有12种方块状态，对应关系列在下方（约定以左下方向为南）”
>
> “似乎有些分不太清楚呢。”
>
> “我解释一下，方块状态的第一个单词表示**箭头所指的方向**，箭头指哪就叫什么——箭头朝南就叫south_xxx，朝上就叫up_xxx。”
>
> “明白了。”
>
> “好的，方块状态的第二个单词表示横线所在的面的名称，都知道方块有上面、底面、东面、西面、南面、北面吧？**横线在哪个面上**，第二个单词就是什么——横线在上面就是xxx_up，横线在东面就是xxx_east。”
>
> “为什么没有xxx_down呢？”
>
> “这时候的拼图方块是水平方向的，我们规定，水平方向的拼图方块的横线总是在方块的上表面。所以拼图方块只有**12**种，而不是16种。”



| 方块状态   | 渲染图                                                       |
| ---------- | ------------------------------------------------------------ |
| south_up   | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/9/94/Jigsaw_Block_%28S%29_JE3_BE2.png/revision/latest/scale-to-width-down/300?cb=20200417014529" alt="img" style="zoom:25%;" /> |
| east_up    | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/e/e5/Jigsaw_Block_%28E%29_JE3.png/revision/latest/scale-to-width-down/300?cb=20200625155856" alt="img" style="zoom:25%;" /> |
| north_up   | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/4/4d/Jigsaw_Block_%28N%29_JE3_BE2.png/revision/latest/scale-to-width-down/300?cb=20200625155948" alt="img" style="zoom:25%;" /> |
| west_up    | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/2/26/Jigsaw_Block_%28W%29_JE3.png/revision/latest/scale-to-width-down/300?cb=20200625160112" alt="img" style="zoom:25%;" /> |
| up_south   | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/c/c7/Jigsaw_Block_%28U%29_JE3_BE2.png/revision/latest/scale-to-width-down/300?cb=20200622134555" alt="img" style="zoom:25%;" /> |
| up_east    | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/c/cf/Jigsaw_Block_%28UE%29.png/revision/latest/scale-to-width-down/300?cb=20200707015253" alt="img" style="zoom:25%;" /> |
| up_north   | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/d/d7/Jigsaw_Block_%28UN%29.png/revision/latest/scale-to-width-down/300?cb=20200707015255" alt="img" style="zoom:25%;" /> |
| up_west    | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/b/b8/Jigsaw_Block_%28UW%29.png/revision/latest/scale-to-width-down/300?cb=20200625160221" alt="img" style="zoom:25%;" /> |
| down_south | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/7/77/Jigsaw_Block_%28D%29_JE3_BE2.png/revision/latest/scale-to-width-down/300?cb=20200707015248" alt="img" style="zoom:25%;" /> |
| down_east  | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/4/4d/Jigsaw_Block_%28DE%29.png/revision/latest/scale-to-width-down/300?cb=20200707015249" alt="img" style="zoom:25%;" /> |
| down_north | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/8/83/Jigsaw_Block_%28DN%29.png/revision/latest/scale-to-width-down/300?cb=20200707015251" alt="img" style="zoom:25%;" /> |
| down_west  | <img src="https://static.wikia.nocookie.net/minecraft_zh_gamepedia/images/8/83/Jigsaw_Block_%28DN%29.png/revision/latest/scale-to-width-down/300?cb=20200707015251" alt="img" style="zoom: 25%;" /> |



> “放置拼图方块要小心一点，对着方块的**侧面**放置会得到**水平方向**的拼图方块，即：第一个单词不是up/down。对着方块的**上/下表面**放置，会得到**竖直方向**的拼图方块。”



由于嫌Jeb太吵，Notch现在决定自己来研究这东西的机制了。

拼图方块不仅有方块状态，作为一个TileEntity，它还有丰富的Nbt标签。

```
nbt: {
    joint: rollable
    name: "minecraft:empty"
    pool: "inifield:wheat_streets"
    final_state: "minecraft:air"
    id: "minecraft:jigsaw"		//方块实体共通的Nbt标签
    target: "inifield:wheat_street"
}
```

他并不明白这些东西的含义，所以他决定亲自实验一下。



### 连锁反应！

Notch把拼图方块放在物品栏里，用/locatebiome找了个平原生物群系来进行他的实验。

想起了Jeb的指导，他对准方块侧面放下拼图方块。

![image-20220524231917848](C:\Users\HP\Desktop\OcteneXin.github.io\_posts\造物者的拼图游戏——1.16大型结构生成.assets\image-20220524231917848.png)



打开F3看了下方块状态，west_up，很好。

接着右键打开GUI写入如下内容：

![image-20220524232031322](C:\Users\HP\Desktop\OcteneXin.github.io\_posts\造物者的拼图游戏——1.16大型结构生成.assets\image-20220524232031322.png)



改变的内容：Target Pool，Target Name，Levels。按下Generate会发生什么呢？

![image-20220524232209805](C:\Users\HP\Desktop\OcteneXin.github.io\_posts\造物者的拼图游戏——1.16大型结构生成.assets\image-20220524232209805.png)



当Notch觉得自己被什么挤了一下的时候，他就感觉大事不妙了。

“这是在开玩笑吧？一个小小的拼图方块能生成这么多东西？”

Notch看了一眼自己物品栏里面躺了很久的结构方块，突然感到自己一下子落伍了许多。他再次坚定了自己的想法：以后再也不要用硬编码写结构了。





附：另一张测试图，于自定义生物群系生成，所生成的道路跨越了数个区块

![image-20220524232647011](C:\Users\HP\Desktop\OcteneXin.github.io\_posts\造物者的拼图游戏——1.16大型结构生成.assets\image-20220524232647011.png)



### 模板池

Notch测试了一会儿，心中依然一团疑惑。Target Pool，Target Name，Levels，这三个参数到底是什么意思呢？

他打了个tp回到家里，看到Hb正在专心致志地对付着一些拼图。

“这里看上去应该拼上去一棵树。”Notch在旁边看了一会儿说道。

“但是这一小堆拼图里面每块画的都是树，应该选什么呢？”

“要是我的话，我就随机选一个，再这样一直拼下去。”

“好像有点道理啊。”



模板池（Template Pool）是具有相同特征拼图的集合。

例如：村庄有好几种房屋（铁匠铺的，图书管理员的），所有的房屋均在一个模板池内；村庄的道路有许多片段，所有的片段都放在一个模板池内。

模板池文件是一个json文件，位于/worldgen/template_pool文件夹下。一个最常见的模板池是这样的：

```
{
  "name": "inifield:wheat_mill",
  "fallback": "minecraft:empty",
  "elements": [
    {
      "weight": 1,
      "element": {
        "element_type": "minecraft:single_pool_element",
        "projection": "rigid",
        "location": "inifield:wheat_mill1",
        "processors": "minecraft:empty"
      }
    }
  ]
}
```

其中：

| 字段     | 值                                        |
| -------- | ----------------------------------------- |
| name     | 模板池名字，在拼图方块中体现为Target Pool |
| fallback | 回落池，暂不作介绍                        |
| elements | 拼图列表，里面存放着一些带权重的拼图      |

带权重的拼图：

| 字段    | 值                               |
| ------- | -------------------------------- |
| weight  | 权重，有多个拼图时权重大的先选择 |
| elememt | 拼图                             |

拼图：

| 字段         | 值                                                           |
| ------------ | ------------------------------------------------------------ |
| element_type | 暂不介绍，只要知道minecraft:single_pool_element最常用        |
| projection   | 放置拼图结构时是否适应地形，rigid为不适应，terrain_matching适应 |
| location     | 拼图结构nbt文件的路径                                        |
| processors   | 处理器，以后介绍                                             |





### 图解：完整拼图过程

这一张图展示了模板池、包含拼图方块的结构、引导方块。

![image-20220524114652081](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114652081.png)

以下为引导方块引导第一层拼图的过程：

![image-20220524114822631](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114822631.png)

![image-20220524114833848](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114833848.png)

![image-20220524114844488](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114844488.png)

![image-20220524114856680](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114856680.png)

![image-20220524114908888](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114908888.png)

以下为第一层拼图生成第二层拼图的过程：

![image-20220524114948450](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524114948450.png)

![image-20220524115019987](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524115019987.png)

![image-20220524115031914](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524115031914.png)

![image-20220524115043478](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524115043478.png)

![image-20220524115054988](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524115054988.png)

通过优化拼图方块的放置位置，我们可以使结构拼合得更加完美。

![image-20220524115230776](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20220524115230776.png)